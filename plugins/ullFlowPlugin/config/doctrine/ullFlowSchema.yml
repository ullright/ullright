UllFlowApp:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [label, doc_label] 
  columns:
    slug:
      type: string(32)
      notnull: true
    label:
      type: string(64)
    doc_label:
      type: string(64)
    icon:
      type: string(32)
#    access_read_id:
#      type: integer
#      type: INTEGER
#    default_list_columns:
#      type: string(255)
#      local: access_read_id
#      foreign: ull_group_id
  relations:
    UllPermission:
      refClass: UllFlowAppPermission
      
#UllFlowAppAccess:
#  package: ullFlowPlugin.lib.model.doctrine
#  inheritance:
#    extends: UllRecord
#    type: concrete
#  columns:
#    ull_flow_app_id:
#      type: integer
#      notnull: true
#    ull_group_id:
#      type: integer
#      notnull: true
#    ull_permission_id:
#      type: integer
#      notnull: true
#  relations:
#    UllFlowApp:
#    UllGroup:
#    UllPermission:

UllFlowAppPermission:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_flow_app_id:
      type: integer
      notnull: true
    ull_permission_id:
      type: integer
      notnull: true  

UllFlowDoc:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_flow_app_id:
      type: integer
      notnull: true
    title:
      type: string(255)
    ull_flow_action_id:
      type: integer
    assigned_to_ull_entity_id:
      type: integer
      notnull: true
    assigned_to_ull_flow_step_id:
      type: integer
      notnull: true
#    priority:
#      type: INTEGER
#    deadline:
#      type: TIMESTAMP
#    custom_field1:
#      type: VARCHAR
#      size: 256
#    read_ull_group_id:
#      type: INTEGER
#    duplicate_tags_for_propel_search:
#      type: LONGVARCHAR
#    write_ull_group_id:
#      type: INTEGER
    #this is used to always set the record dirty, even when only virtual columns are changed.
    dirty:
      type: integer
  relations:
    UllFlowApp:
      foreignAlias: UllFlowDocs
      onDelete: CASCADE
    UllFlowAction:
      foreignAlias: UllFlowDocs      
    UllEntity:
      foreignAlias: UllFlowDocs
      local: assigned_to_ull_entity_id
    UllFlowStep:
      foreignAlias: UllFlowDocs
      local: assigned_to_ull_flow_step_id      
#      onDelete: CASCADE # TODO: test!
      
UllFlowColumnConfig:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [label] 
  columns:
    ull_flow_app_id:
      type: integer
      notnull: true
    slug:
      type: string(32)
      notnull: true                  
    label:
      type: string(64)
    sequence:
      type: integer
    ull_column_type_id:
      type: integer    
    options:
      type: clob      
    is_enabled:
      type: boolean
      default: true
    is_in_list:
      type: boolean
      default: true
    is_mandatory:
      type: boolean
      default: false
    is_subject:
      type: boolean
      default: false
#    ull_access_group_id:
#      type: INTEGER         
    default_value:
      type: string(255)      
  relations:
    UllFlowApp:
      foreignAlias: UllFlowColumnConfigs
      onDelete: CASCADE  
    UllColumnType:
      foreignAlias: UllFlowColumnConfigs
      onDelete: CASCADE
  # TODO: test unique: slug combined with UllFlowApp    
      
UllFlowValue:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_flow_doc_id:
      type: integer
      notnull: true          
    ull_flow_column_config_id:
      type: integer
      notnull: true
    ull_flow_memory_id:
      type: integer
    value:
      type: clob
  relations:
    UllFlowDoc:
      foreignAlias: UllFlowValues
      onDelete: CASCADE  
    UllFlowColumnConfig:
      foreignAlias: UllFlowValues
      onDelete: CASCADE         
      
UllFlowMemory:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_flow_doc_id:
      type: integer
      notnull: true
    ull_flow_step_id:
      type: integer
      notnull: true                          
    ull_flow_action_id:
      type: integer
      notnull: true
    assigned_to_ull_entity_id:
      type: integer
      notnull: true
    comment:
      type: string(255)
    creator_ull_entity_id:
      type: integer
      notnull: true      
  relations:
    UllFlowDoc:
      foreignAlias: UllFlowMemories
      onDelete: CASCADE  
    UllFlowStep:
      foreignAlias: UllFlowMemories
    UllFlowAction:
      foreignAlias: UllFlowMemories
    AssignedToUllEntity:
      class: UllEntity
      foreignAlias: UllFlowMemories
      local: assigned_to_ull_entity_id
    CreatorUllEntity:
      class: UllEntity    
      foreignAlias: UllFlowMemories
      local: creator_ull_entity_id            

UllFlowAction:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [label] 
  columns:
    # a slug is a distinguised name, which is 1:1 connected to the id.
    slug:
      type: varchar(32)
      notnull: true
    label:
      type: varchar(32)
      notnull: true    
    is_status_only:
      type: boolean
    is_enable_validation:
      type: boolean
      default: true      
    is_notify_creator:
      type: boolean
    is_notify_next:
      type: boolean    
    is_in_resultlist:
      type: boolean
      default: true
    is_show_assigned_to:
      type: boolean
    is_comment_mandatory:
      type: boolean
  relations:
#    UllFlowStepActions:
#      class: UllFlowStepAction
#      local: id
#      foreign: ull_flow_action_id
      #foreignAlias: UllFlowAction      
      
UllFlowStep:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [label]
  columns: 
    ull_flow_app_id:
      type: integer
      notnull: true
    slug:
      type: varchar(32)
      notnull: true
    label:
      type: varchar(32)
      notnull: true    
    is_start:
      type: boolean
  relations:
    UllFlowApp:
      foreignAlias: UllFlowSteps
    #UllFlowAction:
    #  refClass: UllFlowStepAction
    #UllFlowStepActions:
    #  class: UllFlowStepAction
    #  local: id
    #  foreign: ull_flow_step_id
    
UllFlowStepAction:
  package: ullFlowPlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:    
    ull_flow_step_id:
      type: integer
    ull_flow_action_id:
      type: integer
    options:
      type: string(255)
    sequence:
      type: integer
  relations:
    UllFlowStep:
      foreignAlias: UllFlowStepActions
    UllFlowAction:
      foreignAlias: UllFlowStepActions
      