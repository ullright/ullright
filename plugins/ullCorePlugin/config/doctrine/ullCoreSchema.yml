# Parent entity
# Includes all fields required by ullCore
UllParentEntity:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    SuperVersionable: #first two parameters are SuperVersionable defaults
      versionColumn:          version
      className:              %CLASS%Version
      enableFutureVersions:   true
  columns:
    first_name:
      type: string(64)
    last_name:
      type: string(64)
    display_name:
      type: string(64)
    username:
      type: string(64)
      unique: true
    email:
      type: string(64)
    password:
      type: string(40)
    sex:
      type: enum
      values: [null, m, f]
    entry_date:
      type: date
    deactivation_date:
      type: date
    separation_date:
      type: date
    ull_employment_type_id:
      type: integer
    ull_job_title_id:
      type: integer
    ull_company_id:
      type: integer
    ull_department_id:
      type: integer
    ull_location_id:
      type: integer
    superior_ull_user_id:
      type: integer
    is_show_in_phonebook:
      type: boolean
      default: true
    phone_extension:
      type: integer(20)
    alternative_phone_extension:
      type: integer
    is_show_extension_in_phonebook:
      type: boolean
      default: true
    fax_extension:
      type: integer(20)
    mobile_number:
      type: string(20)
    is_show_mobile_number_in_phonebook:
      type: boolean
    comment:
      type: string(4000)
    ull_user_status_id:
      type: integer
      notnull: true
      default: 1        #active status
    is_virtual_group:
      type: boolean
      default: false
    # format: usually $username.png
    photo:
      type: string(255)
    is_photo_public:
      type: boolean
      default: true
    # for clone users
    parent_ull_user_id:
      type: integer
  
  relations:
    Superior:
      class: UllUser
      local: superior_ull_user_id
      foreign: id 
    Parent:
      class: UllUser
      local: parent_ull_user_id
      foreign: id      
    UllJobTitle:
      local: ull_job_title_id
      foreign: id
    UllCompany:
      local: ull_company_id
      foreign: id
    UllEmploymentType:
      local: ull_employment_type_id
      foreign: id
    UllDepartment:
      local: ull_department_id
      foreign: id
    UllLocation:
      local: ull_location_id
      foreign: id  
    UllUserStatus:
      local: ull_user_status_id
      foreign: id


#  indexes:
#    ull_parent_entity_display_name:
#      fields: [display_name]
            

  attributes:
    # don't export constraints. This is necessary because mysql 5 cannot delete
    # rows with self-references
    export: [ all, constraints ]

# empty entity class to be overridden by custom Entity class
# (in config/doctrine/schema.yml) to allow definition of additional userfields
#UllEntity:
#  package: ullCorePlugin.lib.model.doctrine
#  inheritance:
#    extends: UllParentEntity
#    type: concrete

UllUser:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllEntity
    type: column_aggregation
    keyValue: user
  
  relations:
    UllGroup:
      refClass: UllEntityGroup
      foreignAlias: UllUsers
      local: ull_entity_id
UllGroup:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllEntity
    type: column_aggregation
    keyValue: group
  relations:
    UllUser:
      refClass: UllEntityGroup
      foreignAlias: UllGroups
      foreign: ull_entity_id

UllEntityGroup:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_entity_id:
      type: integer
      notnull: true
    ull_group_id:
      type: integer
      notnull: true
  relations:
    UllEntity:
      onDelete: CASCADE
    UllGroup:
      onDelete: CASCADE
    UllEntityAsGroup:
      class: UllEntity
      local: ull_group_id
      foreign: id
      foreignAlias: UllEntityGroupsAsGroup
    UllUser:
      #class: UllUser
      local: ull_entity_id
      #foreign: id
      #foreignAlias: UllEntityGroupsAsGroup
      onDelete: CASCADE

UllPermission:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    SuperVersionable:
  columns:
    slug:
      type: string(64)
  relations:
    UllGroup:
      refClass: UllGroupPermission
      foreignAlias: UllPermissions

UllGroupPermission:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    SuperVersionable:
  columns:
    ull_group_id:
      type: integer
      notnull: true
    ull_permission_id:
      type: integer
      notnull: true
  relations:
    UllGroup:
      onDelete: CASCADE
    UllPermission:
      onDelete: CASCADE

# common privileges for record level access check. e.g. "read" and "write"      
UllPrivilege:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    slug:
      type: string(64)

UllJobTitle:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true

UllEmploymentType:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [name]
    Sluggable:
      unique: true
      fields: [name]
      canUpdate: true               
  columns:
    name:
      type: string(100)
      notnull: true

UllCompany:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)

UllDepartment:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)


UllLocation:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)
    street:
      type: string(200)
    city:
      type: string(100)
    country:
      type: string(10) #iso-code?
    post_code:
      type: string(10) #make this integer?
    phone_base_no:
      type: string(20)
    phone_default_extension:
      type: integer
    fax_base_no:
      type: string(20)
    fax_default_extension:
      type: integer

UllUserStatus:    
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [name]
    Sluggable:
      unique: true
      fields: [name]
      canUpdate: true               
  columns:
    name:
      type: string(50)
      notnull: true
    is_active:
      type: boolean
      
      
# Users can be cloned to allow them to fulfill multiple functions in a company
# Example: for the org-chart. One user can be CEO and head of IT at the same time
UllCloneUser:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllEntity
    type: column_aggregation
    keyValue: clone_user