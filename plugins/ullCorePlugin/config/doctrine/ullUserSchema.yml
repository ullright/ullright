# Parent entity
# Includes all fields required by ullCore
UllParentEntity:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    Versionable: #all three parameters are defaults
      versionColumn:  version
      className:      %CLASS%Version
      auditLog:       true
  columns:
    first_name:
      type: string(64)
    last_name:
      type: string(64)
    display_name:
      type: string(64)
    username:
      type: string(64)
      unique: true
    email:
      type: string(64)
    password:
      type: string(40)
    sex:
      type: enum
      values: [null, m, f]
    entry_date:
      type: date
    deactivation_date:
      type: date
    separation_date:
      type: date
    ull_employment_type_id:
      type: integer
    ull_job_title_id:
      type: integer
    ull_company_id:
      type: integer
    ull_department_id:
      type: integer
    ull_location_id:
      type: integer
    superior_ull_user_id:
      type: integer
    phone_extension:
      type: integer(20)
    is_show_extension_in_phonebook:
      type: boolean
    fax_extension:
      type: integer(20)
    is_show_fax_extension_in_phonebook:
      type: boolean
    comment:
      type: string(4000)
    ull_user_status_id:
      type: integer
      notnull: true
      default: 1        #active status



#  indexes:
#    ull_parent_entity_display_name:
#      fields: [display_name]
            

  attributes:
    # don't export constraints. This is necessary because mysql 5 cannot delete
    # rows with self-references
    export: [ all, constraints ]

# empty entity class to be overridden by custom Entity class
# (in config/doctrine/schema.yml) to allow definition of additional userfields
#UllEntity:
#  package: ullCorePlugin.lib.model.doctrine
#  inheritance:
#    extends: UllParentEntity
#    type: concrete

UllUser:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllEntity
    type: column_aggregation
    keyValue: user
  relations:
    UllGroup:
      refClass: UllEntityGroup
      foreignAlias: UllUsers
      local: ull_entity_id
    Superior:
      class: UllUser
      local: superior_ull_user_id
      foreign: id 
    UllJobTitle:
      local: ull_job_title_id
      foreign: id
    UllCompany:
      local: ull_company_id
      foreign: id
    UllEmploymentType:
      local: ull_employment_type_id
      foreign: id
    UllDepartment:
      local: ull_department_id
      foreign: id
    UllLocation:
      local: ull_location_id
      foreign: id  
    UllUserStatus:
      local: ull_user_status_id
      foreign: id

UllGroup:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllEntity
    type: column_aggregation
    keyValue: group
  relations:
    UllUser:
      refClass: UllEntityGroup
      foreignAlias: UllGroups
      foreign: ull_entity_id

UllEntityGroup:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    ull_entity_id:
      type: integer
      notnull: true
    ull_group_id:
      type: integer
      notnull: true
  relations:
    UllEntity:
      onDelete: CASCADE
    UllGroup:
      onDelete: CASCADE
    UllEntityAsGroup:
      class: UllEntity
      local: ull_group_id
      foreign: id
      foreignAlias: UllEntityGroupsAsGroup
    UllUser:
      #class: UllUser
      local: ull_entity_id
      #foreign: id
      #foreignAlias: UllEntityGroupsAsGroup
      onDelete: CASCADE


UllPermission:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    Versionable:
#  actAs:
#    I18n:
#      fields: [label, description]
  columns:
    slug:
      type: string(64)
#    label:
#      type: string(64)
#    description:
#      type: clob
  relations:
    UllGroup:
      refClass: UllGroupPermission
      foreignAlias: UllPermissions
      #local: group_id
      #foreign: ull_group_id

UllGroupPermission:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    Versionable:
  columns:
    ull_group_id:
      type: integer
      notnull: true
    ull_permission_id:
      type: integer
      notnull: true
  relations:
    UllGroup:
      onDelete: CASCADE
    UllPermission:
      onDelete: CASCADE
      
#UllAccessGroup:
#  package: ullCorePlugin.lib.model.doctrine
#  inheritance:
#    extends: UllRecord
#    type: concrete
#  columns:
#    ull_access_id:
#      type: integer
#      primary: true
#    ull_group_id:
#      type: integer
#      primary: true
#  relations:
#    UllGroup:

UllJobTitle:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true

UllEmploymentType:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [name]
  columns:
    name:
      type: string(100)
      notnull: true

UllCompany:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)

UllDepartment:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)


UllLocation:
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  columns:
    name:
      type: string(100)
      notnull: true
    short_name:
      type: string(15)
    street:
      type: string(200)
    city:
      type: string(100)
    country:
      type: string(10) #iso-code?
    post_code:
      type: string(10) #make this integer?
    phone_base_no:
      type: string(20)
    phone_default_extension:
      type: integer
    fax_base_no:
      type: string(20)
    fax_default_extension:
      type: integer

UllUserStatus:    
  package: ullCorePlugin.lib.model.doctrine
  inheritance:
    extends: UllRecord
    type: concrete
  actAs:
    I18n:
      fields: [name]
  columns:
    slug:
      type: string(64)
    name:
      type: string(50)
      notnull: true
    is_active:
      type: boolean
      